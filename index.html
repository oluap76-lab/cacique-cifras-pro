<!doctype html>
<html lang="pt-BR"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cacique Cifras Pr√≥</title>
<link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#8B4513">
<style>body{margin:0;font-family:system-ui;background:#141312;color:#eee}header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:linear-gradient(90deg,#8B4513,#CD853F)}main{max-width:900px;margin:0 auto;padding:16px}input,button{padding:10px;border-radius:10px;border:1px solid #333}button{background:#8B4513;color:#fff;border:none}</style>
</head>
<body>
<header><h1>üéµ Cacique Cifras Pr√≥</h1><button id="installBtn" style="display:none">Instalar</button></header>
<main>
  <p>Vers√£o leve pronta para deploy via celular.</p>
  <div style="display:flex;gap:8px;margin:10px 0"><input id="q" placeholder="Digite m√∫sica ou artista" style="flex:1"><button id="go">Buscar</button></div>
  <ul id="out" style="list-style:none;padding:0;margin:0"></ul>
</main>
<script>
const API_URL = "https://cacique-cifras-api.up.railway.app";
if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js')); }
let deferred; const installBtn=document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); deferred=e; installBtn.style.display='inline-block'; });
installBtn.addEventListener('click', async()=>{ installBtn.style.display='none'; if(deferred){ await deferred.prompt(); deferred=null; }});

const q=document.getElementById('q'), go=document.getElementById('go'), out=document.getElementById('out');
go.onclick=buscar; q.onkeypress=(e)=>{ if(e.key==='Enter') buscar(); };
async function buscar(){
  const term=q.value.trim(); if(!term){ return; }
  out.innerHTML='<li>Buscando‚Ä¶</li>';
  try{
    const r = await fetch(API_URL + '/search?q=' + encodeURIComponent(term), {cache:'no-store'});
    const data = await r.json();
    if(!Array.isArray(data)||!data.length){ out.innerHTML='<li>Nada encontrado</li>'; return; }
    out.innerHTML = data.map(s=>`<li style="display:flex;justify-content:space-between;border-bottom:1px solid #333;padding:8px 4px"><div><strong>${s.title}</strong><br><small>${s.artist||''}</small></div></li>`).join('');
  }catch(e){ out.innerHTML='<li>Erro de rede</li>'; }
}
</script>
</body></html>